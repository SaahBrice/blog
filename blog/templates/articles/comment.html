{% load comment_tags %}
{% load article_tags %}

<div class="comment mb-4" id="comment-{{ comment.id }}">
    <div class="flex items-start space-x-3">
        <img src="{{ comment.author.profile_picture.url }}" alt="{{ comment.author.username }}" class="w-8 h-8 rounded-full">
        <div class="flex-grow">
            <div class="flex items-center">
                <span class="font-semibold text-sm">{{ comment.author.username }}</span>
                <span class="text-xs text-gray-500 ml-2">{{ comment.created_at|timesince }} ago</span>
            </div>
            <p class="text-sm mt-1">{{ comment.content|render_mentions }}</p>
            <div class="flex items-center space-x-4 mt-2">
                <div class="comment-reactions" data-comment-id="{{ comment.id }}">
                    {% for reaction_type in "clap,laugh,sad"|split:"," %}
                        <div class="comment-reaction-container">
                            <button class="comment-reaction text-xs text-gray-500 hover:text-gray-700" data-type="{{ reaction_type }}" data-comment-id="{{ comment.id }}">
                                {% if reaction_type == "clap" %}ğŸ‘
                                {% elif reaction_type == "laugh" %}ğŸ˜‚
                                {% elif reaction_type == "sad" %}ğŸ˜¢
                                {% endif %}
                                <span class="{{ reaction_type }}-count">{{ comment|get_comment_reaction_count:reaction_type }}</span>
                            </button>
                            <div class="reaction-options hidden">
                                <button class="comment-reaction-amount" data-amount="10">+10</button>
                                <button class="comment-reaction-amount" data-amount="50">+50</button>
                                <button class="comment-reaction-amount" data-amount="100">+100</button>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                <button class="toggle-reply-form text-xs text-blue-500 hover:text-blue-700" data-comment-id="{{ comment.id }}">Reply</button>
                {% if comment.replies.exists %}
                    <button class="toggle-subcomments text-xs text-gray-500 hover:text-gray-700" data-comment-id="{{ comment.id }}">
                        <svg class="w-4 h-4 inline-block" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                        {{ comment.replies.count }} replies
                    </button>
                {% endif %}
            </div>
        </div>
    </div>
    <div id="reply-form-{{ comment.id }}" class="mt-2 ml-11 hidden">
        <form method="post" action="{% url 'add_reply' comment.id %}" class="reply-form">
            {% csrf_token %}
            <textarea name="content" placeholder="Write a reply..." class="w-full p-2 text-sm border rounded"></textarea>
            <button type="submit" class="mt-2 bg-blue-500 hover:bg-blue-700 text-white text-xs font-bold py-1 px-2 rounded">Send</button>
        </form>
    </div>
    {% if comment.replies.exists %}
        <div id="subcomments-{{ comment.id }}" class="ml-11 mt-2 hidden">
            <div class="replies" style="margin-left: 50px;">
                {% for reply in comment.replies.all %}
                    {% include "articles/comment.html" with comment=reply %}
                {% endfor %}
            </div>
        </div>
    {% endif %}
</div>